<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.I.G.A.S. - Sistem Informasi Genangan Air Surabaya</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Font Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* Style untuk simulasi data real-time */
        .sensor-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .hazard-level-low {
            background-color: #34d399; /* Green-400 */
        }
        .hazard-level-medium {
            background-color: #fbbf24; /* Amber-400 */
            animation: pulse-medium 2s infinite;
        }
        .hazard-level-high {
            background-color: #f87171; /* Red-400 */
            animation: pulse-high 1s infinite;
        }
        @keyframes pulse-medium {
            0%, 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
        }
        @keyframes pulse-high {
            0%, 100% { box-shadow: 0 0 0 0 rgba(248, 71, 113, 0.4); }
            50% { box-shadow: 0 0 0 15px rgba(248, 71, 113, 0); }
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Header / Navbar -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-gray-800 flex items-center">
                <span class="text-blue-600 mr-2">ðŸŒŠ</span> Sistem Monitoring Genangan Air
            </h1>
            <nav>
                <a href="#" class="text-gray-600 hover:text-blue-600 px-3 py-2 rounded-lg transition duration-150">Dashboard</a>
                <a href="#" class="text-gray-600 hover:text-blue-600 px-3 py-2 rounded-lg transition duration-150">Data Historis</a>
                <a href="#" class="text-gray-600 hover:text-blue-600 px-3 py-2 rounded-lg transition duration-150">Laporan</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <h2 class="text-3xl font-extrabold text-gray-900 mb-6">Monitoring Genangan Jalan Protokol Surabaya</h2>
        
        <!-- Status Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <!-- Card 1: Total Titik Sensor -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                <p class="text-sm font-medium text-gray-500">Total Titik Sensor Aktif</p>
                <p class="text-3xl font-bold text-gray-900 mt-1" id="total-sensors">12</p>
            </div>
            <!-- Card 2: Titik Genangan Rendah -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                <p class="text-sm font-medium text-gray-500">Genangan Rendah (Siaga)</p>
                <p class="text-3xl font-bold text-gray-900 mt-1" id="status-low">5</p>
            </div>
            <!-- Card 3: Titik Genangan Sedang -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-yellow-500">
                <p class="text-sm font-medium text-gray-500">Genangan Sedang (Waspada)</p>
                <p class="text-3xl font-bold text-gray-900 mt-1" id="status-medium">3</p>
            </div>
            <!-- Card 4: Titik Genangan Tinggi -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500">
                <p class="text-sm font-medium text-red-600">Genangan Tinggi (Bahaya)</p>
                <p class="text-3xl font-bold text-red-600 mt-1" id="status-high">1</p>
            </div>
        </div>

        <!-- Real-Time Map and Alerts -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Peta Lokasi (Column 1 & 2) -->
            <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex justify-between items-center">
                    Peta Monitoring Lokasi
                    <span class="text-sm text-gray-500">Update Terakhir: <span id="last-update">11:30:15 WIB</span></span>
                </h3>
                <!-- Placeholder Peta Interaktif - Ditambahkan class 'relative' untuk menambatkan elemen 'absolute' di dalamnya -->
                <div class="bg-gray-200 h-96 rounded-lg flex items-center justify-center text-gray-600 border border-gray-300 relative">
                    <p class="text-lg font-medium">[Peta GIS Interaktif Surabaya]</p>
                    <div class="absolute bottom-4 right-4 bg-white p-2 rounded-lg text-xs shadow-md">
                        <span class="inline-block w-3 h-3 rounded-full bg-green-500 mr-1"></span> Rendah
                        <span class="inline-block w-3 h-3 rounded-full bg-yellow-500 ml-3 mr-1"></span> Sedang
                        <span class="inline-block w-3 h-3 rounded-full bg-red-500 ml-3 mr-1"></span> Tinggi
                    </div>
                </div>
            </div>

            <!-- Panel Notifikasi / Peringatan (Column 3) -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-red-600 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.3 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                    Peringatan Dini (EWS)
                </h3>
                <div id="alerts-container" class="space-y-4 max-h-96 overflow-y-auto">
                    <!-- Alert Item 1 (High Priority) -->
                    <div class="p-3 rounded-lg border-l-4 border-red-600 bg-red-100/50">
                        <p class="text-sm font-semibold text-red-700">BAHAYA - Ketinggian Kritis!</p>
                        <p class="text-xs text-gray-800">Jl. A Yani (Depan CITO) - Kedalaman: 35 cm</p>
                        <p class="text-xs text-gray-600 mt-1">Status: Tinggi (Tidak Dapat Dilalui R2/R4)</p>
                    </div>
                    <!-- Alert Item 2 (Medium Priority) -->
                    <div class="p-3 rounded-lg border-l-4 border-yellow-600 bg-yellow-100/50">
                        <p class="text-sm font-semibold text-yellow-700">WASPADA - Genangan Sedang</p>
                        <p class="text-xs text-gray-800">Jl. Darmo (Taman Bungkul) - Kedalaman: 15 cm</p>
                        <p class="text-xs text-gray-600 mt-1">Status: Sedang (Lalu Lintas Melambat)</p>
                    </div>
                    <!-- Alert Item 3 (Medium Priority) -->
                    <div class="p-3 rounded-lg border-l-4 border-yellow-600 bg-yellow-100/50">
                        <p class="text-sm font-semibold text-yellow-700">WASPADA - Genangan Sedang</p>
                        <p class="text-xs text-gray-800">Jl. Mayjen Sungkono - Kedalaman: 12 cm</p>
                        <p class="text-xs text-gray-600 mt-1">Status: Sedang (Lalu Lintas Melambat)</p>
                    </div>
                    <!-- Alert Item 4 (Low Priority - Simulated) -->
                    <div class="p-3 rounded-lg border-l-4 border-green-600 bg-green-100/50">
                        <p class="text-sm font-semibold text-green-700">SIAGA - Genangan Rendah</p>
                        <p class="text-xs text-gray-800">Jl. Gubernur Suryo - Kedalaman: 5 cm</p>
                        <p class="text-xs text-gray-600 mt-1">Status: Rendah (Masih Aman)</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Detailed Sensor Data List -->
        <section class="mt-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Detail Data Sensor Real-Time</h3>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4" id="sensor-data-container">
                <!-- Sensor cards will be injected here by JavaScript -->
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="mt-12 py-4 text-center text-sm text-gray-500 border-t border-gray-200">
        &copy; 2025 S.I.G.A.S. - Sistem Monitoring Genangan Air Kota Surabaya. Didukung oleh IoT.
    </footer>

    <script>
        // Data simulasi dari server (di aplikasi Next.js/Express.js, ini akan datang dari API)
        const sensorData = [
            { id: 1, location: "Jl. A Yani (CITO)", depth: 35, status: "Bahaya", critical: 30, color: "hazard-level-high" },
            { id: 2, location: "Jl. Darmo (Bungkul)", depth: 15, status: "Waspada", critical: 10, color: "hazard-level-medium" },
            { id: 3, location: "Jl. Mayjen Sungkono", depth: 12, status: "Waspada", critical: 10, color: "hazard-level-medium" },
            { id: 4, location: "Jl. Kertajaya", depth: 2, status: "Aman", critical: 10, color: "hazard-level-low" },
            { id: 5, location: "Jl. Basuki Rahmat", depth: 8, status: "Aman", critical: 10, color: "hazard-level-low" },
            { id: 6, location: "Jl. Gubernur Suryo", depth: 5, status: "Aman", critical: 10, color: "hazard-level-low" },
            { id: 7, location: "Jl. Manyar Kertoarjo", depth: 18, status: "Waspada", critical: 10, color: "hazard-level-medium" },
            { id: 8, location: "Jl. Tunjungan", depth: 1, status: "Aman", critical: 10, color: "hazard-level-low" },
            { id: 9, location: "Jl. Diponegoro", depth: 0, status: "Aman", critical: 10, color: "hazard-level-low" },
            { id: 10, location: "Jl. Jemursari", depth: 28, status: "Bahaya", critical: 30, color: "hazard-level-high" },
            { id: 11, location: "Jl. Merr (Kedinding)", depth: 5, status: "Aman", critical: 10, color: "hazard-level-low" },
            { id: 12, location: "Jl. Raya Darmo", depth: 3, status: "Aman", critical: 10, color: "hazard-level-low" },
        ];

        const sensorContainer = document.getElementById('sensor-data-container');

        // Fungsi untuk menguji apakah status adalah Bahaya
        function isHighHazard(status) {
            return status === 'Bahaya';
        }

        // Fungsi untuk merender kartu sensor
        function renderSensorCards() {
            sensorContainer.innerHTML = ''; // Bersihkan kontainer
            sensorData.forEach(sensor => {
                const isHigh = isHighHazard(sensor.status);
                const card = document.createElement('div');
                card.className = `sensor-card rounded-xl p-4 text-white shadow-xl ${sensor.color} transition-transform transform hover:scale-[1.02] cursor-pointer`;
                card.setAttribute('data-id', sensor.id);
                
                card.innerHTML = `
                    <p class="text-xs font-light opacity-80">Sensor ID: #${sensor.id}</p>
                    <h4 class="text-lg font-bold truncate">${sensor.location}</h4>
                    <div class="mt-2 flex items-baseline justify-between">
                        <span class="text-3xl font-extrabold">${sensor.depth} cm</span>
                        <span class="text-xs font-medium ${isHigh ? 'bg-white text-red-600 px-2 py-0.5 rounded-full' : 'bg-white/30 px-2 py-0.5 rounded-full'}">${sensor.status}</span>
                    </div>
                `;
                sensorContainer.appendChild(card);
            });
        }

        // Fungsi untuk memperbarui waktu terakhir
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('last-update').textContent = timeString + ' WIB';
        }

        // Initial render
        renderSensorCards();
        updateLastUpdateTime();

        // Simulasi pembaruan data real-time (setiap 5 detik)
        setInterval(() => {
            // Perbarui data simulasi (misalnya, membuat satu titik menjadi Bahaya/Sedang secara acak)
            const indexToChange = Math.floor(Math.random() * sensorData.length);
            
            // Randomly increase depth, clamping at 40cm
            let newDepth = sensorData[indexToChange].depth + Math.floor(Math.random() * 10) - 4; // Add a bit of randomness
            if (newDepth < 0) newDepth = 0;
            if (newDepth > 40) newDepth = 40;

            sensorData[indexToChange].depth = newDepth;
            
            // Tentukan status berdasarkan kedalaman baru
            if (newDepth >= 30) {
                sensorData[indexToChange].status = "Bahaya";
                sensorData[indexToChange].color = "hazard-level-high";
            } else if (newDepth >= 10) {
                sensorData[indexToChange].status = "Waspada";
                sensorData[indexToChange].color = "hazard-level-medium";
            } else {
                sensorData[indexToChange].status = "Aman";
                sensorData[indexToChange].color = "hazard-level-low";
            }

            // Hitung ulang status ringkasan
            const low = sensorData.filter(s => s.status === 'Aman').length;
            const medium = sensorData.filter(s => s.status === 'Waspada').length;
            const high = sensorData.filter(s => s.status === 'Bahaya').length;

            document.getElementById('status-low').textContent = low;
            document.getElementById('status-medium').textContent = medium;
            document.getElementById('status-high').textContent = high;


            // Peringatan: Dalam aplikasi nyata, ini akan diperbarui melalui WebSockets/Polling API
            renderSensorCards();
            updateLastUpdateTime();
        }, 5000); // Perbarui setiap 5 detik

        // Dalam implementasi nyata Next.js/Express.js, Anda akan menggunakan WebSockets (misalnya socket.io)
        // di Express.js untuk mengirim data secara real-time ke Next.js frontend,
        // menghilangkan kebutuhan akan interval polling simulasi ini.
    </script>
</body>
</html>
